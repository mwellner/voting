version: '2'
services:
  db:
    build: ./db/
    image: mwellner/voting-db
    ports:
    - "5555:5432"
  redis:
    image: redis:alpine
    ports:
    - "8888:6379"
  result1:
    build: ./result-python/
    image: mwellner/voting-result1
    links:
    - "db"
  result2:
    build: ./result-python/
    image: mwellner/voting-result2
    links:
    - "db"
  result3:
    build: ./result-python/
    image: mwellner/voting-result3
    links:
    - "db"
  nginx:
    build: ./nginx/
    image: mwellner/voting-nginx
    ports:
    - "8080:80"
    links:
    - "result1"
    - "result2"
    - "result3"
  input-python:
    build: ./input-python/
    image: mwellner/voting-input-python
    ports:
    - "8090:5000"
    links:
    - "redis"
  worker1:
    build: ./worker-nodejs/
    image: mwellner/voting-worker1
    links:
    - "redis"
    - "db"
  worker2:
    build: ./worker-nodejs/
    image: mwellner/voting-worker2
    links:
    - "redis"
    - "db"
  worker3:
    build: ./worker-nodejs/
    image: mwellner/voting-worker3
    links:
    - "redis"
    - "db"
